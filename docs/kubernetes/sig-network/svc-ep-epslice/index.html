<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Service 与 Endpoints、EndpointSlice 那些事 # Service 资源 # k8s Service 定义了这样一种抽象：逻辑上的一组 Pod，一种可以访问它们的策略 —— 通常称为微服务。 Service 所针对的 Pod 集合通常是通过 LabelSelector 来确定的。 LabelSelector 选中的 Pod，将会自动创建与 Service 同名且同 Namespace 的 Endpoint 对象，将 Pod 的 IP 写入其中。
如果没有 LabelSelector，用户可能是希望 Service 关联的后端是集群外的服务，或者是其他 Namespace； 如果用户还想要使用负载均衡服务，需要自行创建与 Service 同名的 Endpoints 对象。
Service 类型 # k8s Service 分为 4 种类型（svc.spec.type）：
ClusterIP：通过集群的内部 IP 暴露服务，选择该值时服务只能够在集群内部访问。 这也是默认的 ServiceType。 NodePort：通过每个节点上的 IP 和静态端口（NodePort）暴露服务。 NodePort 服务会路由到自动创建的 ClusterIP 服务。 通过请求 &lt;node ip&gt;:&lt;node port&gt;，你可以从集群的外部访问一个 NodePort 服务。 LoadBalance：使用云提供商的负载均衡器向外部暴露服务。 外部负载均衡器可以将流量路由到自动创建的 NodePort 服务和 ClusterIP 服务上。 ExternalName：通过返回 CNAME 和对应值，可以将服务映射到 externalName 字段的内容； 例如，foo.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Service 与 Endpoints、EndpointSlice 那些事" />
<meta property="og:description" content="Service 与 Endpoints、EndpointSlice 那些事 # Service 资源 # k8s Service 定义了这样一种抽象：逻辑上的一组 Pod，一种可以访问它们的策略 —— 通常称为微服务。 Service 所针对的 Pod 集合通常是通过 LabelSelector 来确定的。 LabelSelector 选中的 Pod，将会自动创建与 Service 同名且同 Namespace 的 Endpoint 对象，将 Pod 的 IP 写入其中。
如果没有 LabelSelector，用户可能是希望 Service 关联的后端是集群外的服务，或者是其他 Namespace； 如果用户还想要使用负载均衡服务，需要自行创建与 Service 同名的 Endpoints 对象。
Service 类型 # k8s Service 分为 4 种类型（svc.spec.type）：
ClusterIP：通过集群的内部 IP 暴露服务，选择该值时服务只能够在集群内部访问。 这也是默认的 ServiceType。 NodePort：通过每个节点上的 IP 和静态端口（NodePort）暴露服务。 NodePort 服务会路由到自动创建的 ClusterIP 服务。 通过请求 &lt;node ip&gt;:&lt;node port&gt;，你可以从集群的外部访问一个 NodePort 服务。 LoadBalance：使用云提供商的负载均衡器向外部暴露服务。 外部负载均衡器可以将流量路由到自动创建的 NodePort 服务和 ClusterIP 服务上。 ExternalName：通过返回 CNAME 和对应值，可以将服务映射到 externalName 字段的内容； 例如，foo." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://howieyuen.github.io/docs/kubernetes/sig-network/svc-ep-epslice/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2023-01-31T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-03-03T20:47:18+08:00" />

<title>Service 与 Endpoints、EndpointSlice 那些事 | 袁昊的学习笔记</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css" integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.b5b6482a43fb0fd5edbcb6decc699fa34ac8de01afbf582980fdc0c285f46df2.js" integrity="sha256-tbZIKkP7D9XtvLbezGmfo0rI3gGvv1gpgP3AwoX0bfI=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.jpeg" alt="Logo" /><span>袁昊的学习笔记</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Golang</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b81db6492518b1ec8f31de69b0812196" class="toggle"  />
    <label for="section-b81db6492518b1ec8f31de69b0812196" class="flex justify-between">
      <a role="button" class="">数据结构</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/data-structure/chan/" class="">chan</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/data-structure/map/" class="">map</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/data-structure/slice/" class="">slice</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-def2dd5a69e672402d635862e3155cbd" class="toggle"  />
    <label for="section-def2dd5a69e672402d635862e3155cbd" class="flex justify-between">
      <a role="button" class="">语言基础</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/language-basics/unsafe/" class="">unsafe</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/language-basics/reflect/" class="">reflect</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-873194c4b0ec7a578576232c8d994c31" class="toggle"  />
    <label for="section-873194c4b0ec7a578576232c8d994c31" class="flex justify-between">
      <a role="button" class="">内存管理</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/memory-manage/memory-model/" class="">内存模型</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b2e47afb5c03c825c53136ae4cc0848f" class="toggle"  />
    <label for="section-b2e47afb5c03c825c53136ae4cc0848f" class="flex justify-between">
      <a role="button" class="">golang 工具</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/tools/pprof/" class="">pprof</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Kubernetes</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-99bae3fc02ce73f8422ca93f733590ac" class="toggle"  />
    <label for="section-99bae3fc02ce73f8422ca93f733590ac" class="flex justify-between">
      <a role="button" class="">kube-apisever</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/authentication/" class="">认证机制</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/authorization/" class="">鉴权机制</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/garbage-collector/" class="">垃圾回收</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/key-design-of-etcd-watch/" class="">watch 关键设计</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/crd/" class="">CRD 入门和使用</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8db6df9b09828d3b4f51a3f0e8635341" class="toggle"  />
    <label for="section-8db6df9b09828d3b4f51a3f0e8635341" class="flex justify-between">
      <a role="button" class="">kube-controller-manager</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-controller-manager/code-analysis-of-garbagecollector-controller/" class="">GC Controller 源码分析</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-controller-manager/code-analysis-of-daemonset-controller/" class="">DaemonSet Controller 源码分析</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-controller-manager/code-analysis-of-statefulset-controller/" class="">Statefulset Controller 源码分析</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-controller-manager/k8s-apps-rolling-update/" class="">无状态应用滚动更新</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f69546525118538b309149a83388b048" class="toggle"  />
    <label for="section-f69546525118538b309149a83388b048" class="flex justify-between">
      <a role="button" class="">kube-scheduler</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-scheduler/advanced-scheduling/" class="">高级调度</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a5e90c89093229651c03236cd9ca0bf7" class="toggle"  />
    <label for="section-a5e90c89093229651c03236cd9ca0bf7" class="flex justify-between">
      <a role="button" class="">kubelet</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kubelet/kubelet-topology-manager/" class="">Topology Manager 设计方案</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kubelet/kubelet-eviction-manager/" class="">Eviction Manager 工作机制</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a153eacbc14a16cf1bd898e9025b6121" class="toggle" checked />
    <label for="section-a153eacbc14a16cf1bd898e9025b6121" class="flex justify-between">
      <a role="button" class="">sig-network</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/sig-network/svc-ep-epslice/" class="active">Service 与 Endpoints、EndpointSlice 那些事</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/sig-network/learn-about-Service/" class="">深入了解 Service</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>XaC(Everything as Code)</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-87d48c1068c47e29214232148a6ffd46" class="toggle"  />
    <label for="section-87d48c1068c47e29214232148a6ffd46" class="flex justify-between">
      <a role="button" class="">Infra as Code</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/XaC/infra-as-code/getting-started-of-acorn/" class="">Acorn：k8s 应用部署框架</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/XaC/infra-as-code/terraform-workflow/" class="">Terraform 执行状态和阶段关系</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e55a75d91330d73a365d7c5ff163ca1d" class="toggle"  />
    <label for="section-e55a75d91330d73a365d7c5ff163ca1d" class="flex justify-between">
      <a role="button" class="">Secret as Code</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/XaC/secret-as-code/helm-secrets/" class="">Helm Secrets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/XaC/secret-as-code/kamus/" class="">Kamus</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/XaC/secret-as-code/secrets-store-csi-driver/" class="">Secrets Store CSI Driver</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/XaC/secret-as-code/sealed-secrets/" class="">Sealed Secrets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/XaC/secret-as-code/external-secret-operator/" class="">External Secrets Operator</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0a7e8a0838cc922d31092abb572fa971" class="toggle"  />
    <label for="section-0a7e8a0838cc922d31092abb572fa971" class="flex justify-between">
      <a role="button" class="">CI/CD Tools</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/XaC/cicd/argocd/" class="">使用 ArgoCD ApplicationSet 管理多集群</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Getting-Started</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/getting-started/monorepo/" class="">MonoRepo</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getting-started/circle-ci/" class="">Circle CI</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Translation</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c0f96e48b4daa204312defe713af5b04" class="toggle"  />
    <label for="section-c0f96e48b4daa204312defe713af5b04" class="flex justify-between">
      <a role="button" class="">Protocol Buffers</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/translation/protobuf/overview-of-protocal-buffers/" class="">概述</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/translation/protobuf/language-guideproto3/" class="">语言指南（proto3）</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-41d00712937ef3a8ada203a9e4f0c745" class="toggle"  />
    <label for="section-41d00712937ef3a8ada203a9e4f0c745" class="flex justify-between">
      <a role="button" class="">LeetCode</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/leetcode/0321/" class="">321. 拼接最大数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/leetcode/0416/" class="">416. 分割等和子集</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/" >
        Blogs
      </a>
  </li>
  
  <li>
    <a href="https://github.com/howieyuen/" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Service 与 Endpoints、EndpointSlice 那些事</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#service-与-endpointsendpointslice-那些事">Service 与 Endpoints、EndpointSlice 那些事</a>
      <ul>
        <li><a href="#service-资源">Service 资源</a></li>
        <li><a href="#service-类型">Service 类型</a></li>
        <li><a href="#headless-service">Headless Service</a></li>
        <li><a href="#endpoints">Endpoints</a></li>
        <li><a href="#endpointslice">EndpointSlice</a>
          <ul>
            <li><a href="#动机">动机</a></li>
            <li><a href="#定义">定义</a></li>
            <li><a href="#属主">属主</a></li>
          </ul>
        </li>
        <li><a href="#关联关系">关联关系</a></li>
        <li><a href="#参考资料">参考资料</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="service-与-endpointsendpointslice-那些事">
  Service 与 Endpoints、EndpointSlice 那些事
  <a class="anchor" href="#service-%e4%b8%8e-endpointsendpointslice-%e9%82%a3%e4%ba%9b%e4%ba%8b">#</a>
</h1>
<h2 id="service-资源">
  Service 资源
  <a class="anchor" href="#service-%e8%b5%84%e6%ba%90">#</a>
</h2>
<p>k8s Service 定义了这样一种抽象：逻辑上的一组 Pod，一种可以访问它们的策略 —— 通常称为微服务。
Service 所针对的 Pod 集合通常是通过 LabelSelector 来确定的。
LabelSelector 选中的 Pod，将会自动创建与 Service 同名且同 Namespace 的 Endpoint 对象，将 Pod 的 IP 写入其中。</p>
<p>如果没有 LabelSelector，用户可能是希望 Service 关联的后端是集群外的服务，或者是其他 Namespace；
如果用户还想要使用负载均衡服务，需要自行创建与 Service 同名的 Endpoints 对象。</p>
<h2 id="service-类型">
  Service 类型
  <a class="anchor" href="#service-%e7%b1%bb%e5%9e%8b">#</a>
</h2>
<p>k8s Service 分为 4 种类型（<code>svc.spec.type</code>）：</p>
<ul>
<li>ClusterIP：通过集群的内部 IP 暴露服务，选择该值时服务只能够在集群内部访问。
这也是默认的 <code>ServiceType</code>。</li>
<li>NodePort：通过每个节点上的 IP 和静态端口（NodePort）暴露服务。
NodePort 服务会路由到自动创建的 ClusterIP 服务。
通过请求 <code>&lt;node ip&gt;:&lt;node port&gt;</code>，你可以从集群的外部访问一个 <code>NodePort</code> 服务。</li>
<li>LoadBalance：使用云提供商的负载均衡器向外部暴露服务。
外部负载均衡器可以将流量路由到自动创建的 <code>NodePort</code> 服务和 <code>ClusterIP</code> 服务上。</li>
<li>ExternalName：通过返回 <code>CNAME</code> 和对应值，可以将服务映射到 <code>externalName</code> 字段的内容；
例如，<code>foo.bar.example.com</code>，无需创建任何类型代理。</li>
</ul>
<h2 id="headless-service">
  Headless Service
  <a class="anchor" href="#headless-service">#</a>
</h2>
<p>无头服务，也可以算是 Service 的一种类型，有时不需要或不想要负载均衡，以及单独的 Service IP，
可以通过指定 Cluster IP（<code>spec.clusterIP</code>）的值为 None 来创建 Headless Service。</p>
<p>如果有 LabelSelector，Endpoints Controller 在 API 中创建 Endpoints 对象，
并且修改 DNS 配置返回 IP 地址，通过这个地址直接到达 Service 的后端 Pod 上。</p>
<p>如果每有 LabelSelector，Endpoints Controller 不会创建 Endpoints 对象。
但DNS 系统会查找和配置，无论是：</p>
<ul>
<li>对于 ExternalName 类型的服务，查找其 CNAME 记录</li>
<li>对所有其他类型的服务，查找与 Service 名称相同的任何 Endpoints 的记录</li>
</ul>
<h2 id="endpoints">
  Endpoints
  <a class="anchor" href="#endpoints">#</a>
</h2>
<p>刚才提到，用户一般不需要主动创建 Endpoints 记录，Service 会根据其类型，决定是否创建，
因此 Service 和 Endpoints 之间<strong>不是属主和附属的关系</strong>（<code>ownerReference</code>）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Endpoints</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">creationTimestamp</span>: <span style="color:#e6db74">&#34;2022-09-08T09:55:14Z&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">frontend</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">sampleapp</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resourceVersion</span>: <span style="color:#e6db74">&#34;1655960&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">uid</span>: <span style="color:#ae81ff">4a8381ac-a4b6-477e-a1ed-ddf3d9f47d2c</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subsets</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">addresses</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">ip</span>: <span style="color:#ae81ff">172.17.0.21</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">minikube</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetRef</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">sampleappprod-8445c57bd7-c7vnt</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">sampleapp</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resourceVersion</span>: <span style="color:#e6db74">&#34;1655943&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">uid</span>: <span style="color:#ae81ff">38f10fd0-a30c-4ede-87e5-e446d571f054</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">ip</span>: <span style="color:#ae81ff">172.17.0.25</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">minikube</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetRef</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">sampleappprod-8445c57bd7-4bpdd</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">sampleapp</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resourceVersion</span>: <span style="color:#e6db74">&#34;1655956&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">uid</span>: <span style="color:#ae81ff">3c760d52-d389-4fb2-8219-d50fc418e831</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span></code></pre></div><h2 id="endpointslice">
  EndpointSlice
  <a class="anchor" href="#endpointslice">#</a>
</h2>
<h3 id="动机">
  动机
  <a class="anchor" href="#%e5%8a%a8%e6%9c%ba">#</a>
</h3>
<p>由于任一 Service 的所有网络端点都保存在同一个 Endpoints 资源中，
这类资源可能变得非常巨大，而这一变化会影响到 Kubernetes 组件的性能，
并在 Endpoints 变化时产生大量的网络流量和额外的处理。
EndpointSlice 能够缓解这一问题，还能为一些诸如拓扑路由这类的额外功能提供一个可扩展的平台。</p>
<h3 id="定义">
  定义
  <a class="anchor" href="#%e5%ae%9a%e4%b9%89">#</a>
</h3>
<p>在 Kubernetes 中，EndpointSlice 包含对一组网络端点的引用。
控制面会自动为设置了 LabelSelector 的 Kubernetes Service 创建 EndpointSlice。
这些 EndpointSlice 将包含对与 Service 的 LabelSelector 匹配的所有 Pod 的引用。
EndpointSlice 通过唯一的协议、端口号和 Service 名称将 Endpoints 组织在一起。</p>
<h3 id="属主">
  属主
  <a class="anchor" href="#%e5%b1%9e%e4%b8%bb">#</a>
</h3>
<p>在大多数场合下，EndpointSlice 都由某个 Service 所有，
因为 EndpointSlice 正是为该服务跟踪记录其 Endpoints。
这一属主关系是通过为每个 EndpointSlice 设置 ownerReference，
同时设置 kubernetes.io/service-name 标签来标明的，
目的是方便查找属于某 Service 的所有 EndpointSlice。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">discovery.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">EndpointSlice</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">creationTimestamp</span>: <span style="color:#e6db74">&#34;2022-09-08T09:55:14Z&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">generateName</span>: <span style="color:#ae81ff">frontend-</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">generation</span>: <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">endpointslice.kubernetes.io/managed-by</span>: <span style="color:#ae81ff">endpointslice-controller.k8s.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kubernetes.io/service-name</span>: <span style="color:#ae81ff">frontend</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">frontend-xq96c</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">sampleapp</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ownerReferences</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">blockOwnerDeletion</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">frontend</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">uid</span>: <span style="color:#ae81ff">2e6d626f-e8aa-4edb-a42f-19caf7acdf46</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resourceVersion</span>: <span style="color:#e6db74">&#34;1655961&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">uid</span>: <span style="color:#ae81ff">42c13581-9ba7-4d7e-95af-57742c028446</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">addressType</span>: <span style="color:#ae81ff">IPv4</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">endpoints</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">addresses</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">172.17.0.25</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ready</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">serving</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">terminating</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">minikube</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">targetRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">sampleappprod-8445c57bd7-4bpdd</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">sampleapp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resourceVersion</span>: <span style="color:#e6db74">&#34;1655956&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">uid</span>: <span style="color:#ae81ff">3c760d52-d389-4fb2-8219-d50fc418e831</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">addresses</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">172.17.0.21</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ready</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">serving</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">terminating</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">minikube</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">targetRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">sampleappprod-8445c57bd7-c7vnt</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">sampleapp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resourceVersion</span>: <span style="color:#e6db74">&#34;1655943&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">uid</span>: <span style="color:#ae81ff">38f10fd0-a30c-4ede-87e5-e446d571f054</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span></code></pre></div><h2 id="关联关系">
  关联关系
  <a class="anchor" href="#%e5%85%b3%e8%81%94%e5%85%b3%e7%b3%bb">#</a>
</h2>
<p>
  <img src="/kubernetes/sig-network/relationship.png" alt="" /></p>
<h2 id="参考资料">
  参考资料
  <a class="anchor" href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99">#</a>
</h2>
<ul>
<li>
  <a href="https://kubernetes.io/docs/concepts/services-networking/service/">https://kubernetes.io/docs/concepts/services-networking/service/</a></li>
<li>
  <a href="https://kubernetes.io/docs/concepts/services-networking/endpoint-slices/">https://kubernetes.io/docs/concepts/services-networking/endpoint-slices/</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/howieyuen/howieyuen.github.io/commit/f381ca0dfd63449920ff3fedc5230abed8b67dd4" title='Last modified by howieyuen | March 3, 2024' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>March 3, 2024</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">



<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'b4cc17dbafc8ad637453',
    clientSecret: '77b4685b4d6da0280eca116a66b6f01244033d35',
    repo: 'howieyuen.github.io',
    owner: 'howieyuen',
    admin: ['howieyuen'],
    id: location.pathname, 
    distractionFreeMode: false 
  });
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
      return;
    }
    gitalk.render('gitalk-container');
  })();
</script>

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#service-与-endpointsendpointslice-那些事">Service 与 Endpoints、EndpointSlice 那些事</a>
      <ul>
        <li><a href="#service-资源">Service 资源</a></li>
        <li><a href="#service-类型">Service 类型</a></li>
        <li><a href="#headless-service">Headless Service</a></li>
        <li><a href="#endpoints">Endpoints</a></li>
        <li><a href="#endpointslice">EndpointSlice</a>
          <ul>
            <li><a href="#动机">动机</a></li>
            <li><a href="#定义">定义</a></li>
            <li><a href="#属主">属主</a></li>
          </ul>
        </li>
        <li><a href="#关联关系">关联关系</a></li>
        <li><a href="#参考资料">参考资料</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












