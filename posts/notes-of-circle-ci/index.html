<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="CircleCI 是基于云的 CI/CD 工具，可自动执行软件构建和交付过程。它提供快速的配置和维护，没有任何复杂性。
由于它是基于云的 CI/CD 工具，因此消除了专用服务器的困扰，并降低了维护本地服务器的成本。
此外，基于云的服务器是可扩展的，健壮的，并有助于更快地部署应用程序。">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Circle CI 学习笔记" />
<meta property="og:description" content="CircleCI 是基于云的 CI/CD 工具，可自动执行软件构建和交付过程。它提供快速的配置和维护，没有任何复杂性。
由于它是基于云的 CI/CD 工具，因此消除了专用服务器的困扰，并降低了维护本地服务器的成本。
此外，基于云的服务器是可扩展的，健壮的，并有助于更快地部署应用程序。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://howieyuen.github.io/posts/notes-of-circle-ci/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-10-15T18:20:57+08:00" />

<title>Circle CI 学习笔记 | 袁昊的学习笔记</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css" integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.7cf776de1b9e3072dd4e9be9c3b76f40643f56bd32dce932c60777174934ef3d.js" integrity="sha256-fPd23hueMHLdTpvpw7dvQGQ/Vr0y3Okyxgd3F0k07z0=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.jpeg" alt="Logo" /><span>袁昊的学习笔记</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Golang</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-aa0ad5dadefefc3354befb0f21b44571" class="toggle"  />
    <label for="section-aa0ad5dadefefc3354befb0f21b44571" class="flex justify-between">
      <a role="button" class="">数据结构</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/data-structure/chan/" class="">chan</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/data-structure/map/" class="">map</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/data-structure/slice/" class="">slice</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9730b84098027970ce9876389c401abb" class="toggle"  />
    <label for="section-9730b84098027970ce9876389c401abb" class="flex justify-between">
      <a role="button" class="">语言基础</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/language-basics/unsafe/" class="">unsafe</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/language-basics/reflect/" class="">reflect</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-84d526a58cfe5a50fb73329d6c7bd14a" class="toggle"  />
    <label for="section-84d526a58cfe5a50fb73329d6c7bd14a" class="flex justify-between">
      <a role="button" class="">内存管理</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/memory-manage/memory-model/" class="">内存模型</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-084099e607ed94fee6028accac1c176c" class="toggle"  />
    <label for="section-084099e607ed94fee6028accac1c176c" class="flex justify-between">
      <a role="button" class="">golang 工具</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/golang/tools/pprof/" class="">pprof</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Kubernetes</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-103a3040e6af1931bd7a973aa3d5fe12" class="toggle"  />
    <label for="section-103a3040e6af1931bd7a973aa3d5fe12" class="flex justify-between">
      <a role="button" class="">kube-apisever</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/authorization/" class="">鉴权机制</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/authentication/" class="">认证机制</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/garbage-collector/" class="">垃圾回收</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/key-design-of-etcd-watch/" class="">watch 关键设计</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-apiserver/crd/" class="">CRD 入门和使用</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-55afec95d17025ab2841fd395bf5e066" class="toggle"  />
    <label for="section-55afec95d17025ab2841fd395bf5e066" class="flex justify-between">
      <a role="button" class="">kube-controller-manager</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-controller-manager/code-analysis-of-garbagecollector-controller/" class="">GC Controller 源码分析</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-controller-manager/code-analysis-of-daemonset-controller/" class="">DaemonSet Controller 源码分析</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-controller-manager/code-analysis-of-statefulset-controller/" class="">Statefulset Controller 源码分析</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-controller-manager/k8s-apps-rolling-update/" class="">无状态应用滚动更新</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6c06d491bb5aface6ab2585a8049b13f" class="toggle"  />
    <label for="section-6c06d491bb5aface6ab2585a8049b13f" class="flex justify-between">
      <a role="button" class="">kube-scheduler</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kube-scheduler/advanced-scheduling/" class="">高级调度</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-89eea73f7e04e77c22ade24239d6a83e" class="toggle"  />
    <label for="section-89eea73f7e04e77c22ade24239d6a83e" class="flex justify-between">
      <a role="button" class="">kubelet</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kubelet/kubelet-topology-manager/" class="">Topology Manager 设计方案</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/kubelet/kubelet-eviction-manager/" class="">Eviction Manager 工作机制</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f0e31a9428c0c5fa066c9ad36b1ae0b6" class="toggle"  />
    <label for="section-f0e31a9428c0c5fa066c9ad36b1ae0b6" class="flex justify-between">
      <a role="button" class="">sig-network</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kubernetes/sig-network/learn-about-Service/" class="">深入了解 Service</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Translation</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f59f78b27df0d3218be457339234a283" class="toggle"  />
    <label for="section-f59f78b27df0d3218be457339234a283" class="flex justify-between">
      <a role="button" class="">Protocol Buffers</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/translation/protobuf/overview-of-protocal-buffers/" class="">概述</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/translation/protobuf/language-guideproto3/" class="">语言指南（proto3）</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f44f2048d84a295b965240d95f5edc80" class="toggle"  />
    <label for="section-f44f2048d84a295b965240d95f5edc80" class="flex justify-between">
      <a role="button" class="">X as Code</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/translation/XaC/how-to-manage-gitops-secrets-a-detailed-guide/" class="">如何管理 GitOps Secret：详细指南</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-20038bcc21ca3d914920842c4a32533d" class="toggle"  />
    <label for="section-20038bcc21ca3d914920842c4a32533d" class="flex justify-between">
      <a role="button" class="">LeetCode</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/leetcode/0321/" class="">321. 拼接最大数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/leetcode/0416/" class="">416. 分割等和子集</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/" >
        Blogs
      </a>
  </li>
  
  <li>
    <a href="https://github.com/howieyuen/" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Circle CI 学习笔记</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#基本概念">基本概念</a>
      <ul>
        <li><a href="#管控层">管控层</a>
          <ul>
            <li><a href="#project">Project</a></li>
            <li><a href="#configuration">Configuration</a></li>
            <li><a href="#user-type">User Type</a></li>
          </ul>
        </li>
        <li><a href="#配置层">配置层</a>
          <ul>
            <li><a href="#pipeline">Pipeline</a></li>
            <li><a href="#orb">Orb</a></li>
            <li><a href="#job">Job</a></li>
            <li><a href="#executor-和-images">Executor 和 images</a></li>
            <li><a href="#step">Step</a></li>
            <li><a href="#image">Image</a></li>
            <li><a href="#workflow">Workflow</a></li>
            <li><a href="#cacheworkspaceartifact">Cache/Workspace/Artifact</a></li>
          </ul>
        </li>
        <li><a href="#小结">小结</a></li>
      </ul>
    </li>
    <li><a href="#orb-简介">Orb 简介</a>
      <ul>
        <li><a href="#command-示例">Command 示例</a></li>
        <li><a href="#executor-示例">Executor 示例</a></li>
        <li><a href="#job-示例">Job 示例</a></li>
      </ul>
    </li>
    <li><a href="#orb-开发实践">Orb 开发实践</a>
      <ul>
        <li><a href="#取名">取名</a></li>
        <li><a href="#初始化">初始化</a></li>
        <li><a href="#发布">发布</a></li>
      </ul>
    </li>
    <li><a href="#参考资料">参考资料</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/notes-of-circle-ci/">Circle CI 学习笔记</a>
  </h1>
  
  <h5>December 14, 2021</h5>



  
  <div>
    
      <a href="/categories/CI/CD/">CI/CD</a>
  </div>
  

  
  <div>
    
      <a href="/tags/CircleCI/">CircleCI</a>, 
      <a href="/tags/Orb/">Orb</a>
  </div>
  



<p>CircleCI 是基于云的 CI/CD 工具，可自动执行软件构建和交付过程。它提供快速的配置和维护，没有任何复杂性。
由于它是基于云的 CI/CD 工具，因此消除了专用服务器的困扰，并降低了维护本地服务器的成本。
此外，基于云的服务器是可扩展的，健壮的，并有助于更快地部署应用程序。</p>
<h1 id="基本概念">
  基本概念
  <a class="anchor" href="#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5">#</a>
</h1>
<p>首先介绍下 Circle CI 的
  <a href="https://circleci.com/docs/2.0/concepts/">基本概念</a>，帮助大家理解 Circle CI 是如何管理 CI/CD 流程。</p>
<h2 id="管控层">
  管控层
  <a class="anchor" href="#%e7%ae%a1%e6%8e%a7%e5%b1%82">#</a>
</h2>
<h3 id="project">
  Project
  <a class="anchor" href="#project">#</a>
</h3>
<p>Circle CI 项目在你的 VCS（GitHub 或者 Bitbucket）中 ，共享代码库的名称。在 Circle CI 的主页中点击 <em>Projects</em> 可以自由添加项目进入仪表盘，以追踪代码变更。</p>
<h3 id="configuration">
  Configuration
  <a class="anchor" href="#configuration">#</a>
</h3>
<p>Circle CI 遵循配置即代码（Configuration as Code）原则，整个 CI/CD 的流程都是通过 <em>config.yml</em> 文件，该文件位于项目根目录下的 <em>.circleci</em> 文件夹中。以下按照术语和依赖性顺序，列举了 Circle CI 最常见的组件：</p>
<ul>
<li>Pipeline：代码表整个配置，仅用于 Circle CI 云</li>
<li>Workflow：负责编排多个 Job</li>
<li>Job：负责运行执行命令的一系列 Step</li>
<li>Step：运行命令（例如安装依赖项或运行测试）和 shell 脚本</li>
</ul>
<h3 id="user-type">
  User Type
  <a class="anchor" href="#user-type">#</a>
</h3>
<p>大多数都是从 VCS 帐号中继承的权限，主要包括以下四种：</p>
<ul>
<li>组织管理员（Organization Administrator）：从 VCS 继承的权限级别。
<ul>
<li>GitHub：Owner 权限，并且至少关注了一个在 Circle CI 上的构建的项目。</li>
<li>Bitbucket：Admin 权限，并且至少关注了一个在 Circle CI 上的构建的项目。</li>
</ul>
</li>
<li>项目管理员（Project Administrator）：是将 GitHub 或 Bitbucket 的 Repo 作为项目添加到 Circle CI 的用户。
<ul>
<li>用户（User）：是组织内的个人用户，从 VCS 继承。</li>
</ul>
</li>
<li>Circle CI 用户（Circle CI User）：可以使用用户名和密码登录 Circle CI 平台的任何人。</li>
</ul>
<h2 id="配置层">
  配置层
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e5%b1%82">#</a>
</h2>
<h3 id="pipeline">
  Pipeline
  <a class="anchor" href="#pipeline">#</a>
</h3>
<p>管道是触发项目工作时运行的全套流程，它包含了 Workflow，Workflow 会协调 Job，这些都应在项目的配置文件中。<strong>Pipeline 在 Circle CI 2.X 版本不可用</strong>。</p>
<h3 id="orb">
  Orb
  <a class="anchor" href="#orb">#</a>
</h3>
<p>
  <a href="https://circleci.com/docs/2.0/orb-intro/">Orb</a> 是可重复使用的代码片段，有助于自动化重复流程、加快项目设置并使其易于与第三方工具集成。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#ae81ff">2.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">orbs</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">maven</span>: <span style="color:#ae81ff">circleci/maven@0.0.12</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">workflow</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">maven_test</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>			- <span style="color:#ae81ff">maven/test</span>
</span></span></code></pre></div><h3 id="job">
  Job
  <a class="anchor" href="#job">#</a>
</h3>
<p>作业是配置的基础，也是 Step 的集合，根据需要运行命令/脚本。每个作业必须声明 Executor，它可以是：</p>
<ul>
<li>docker：必须指定镜像</li>
<li>machine：存在默认镜像</li>
<li>windows：必须使用 Window Orb</li>
<li>macos：必须执行 XCode 版本</li>
</ul>
<h3 id="executor-和-images">
  Executor 和 images
  <a class="anchor" href="#executor-%e5%92%8c-images">#</a>
</h3>
<p>每个作业都可以在唯一的执行器中运行，可以是 Docker 容器，也可以是 Linux/Windows 的虚拟机。<strong>Circle CI 2.X 不支持 MacOS</strong>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#ae81ff">2.1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">build1</span>: <span style="color:#75715e"># job 名称</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">docker</span>: <span style="color:#75715e"># 使用 docker 环境</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">buildpack-deps:trusty</span> <span style="color:#75715e"># 主镜像</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">username</span>: <span style="color:#ae81ff">mydockerhub-user</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">password</span>: <span style="color:#ae81ff">$DOCKERHUB_PASSWORD </span> <span style="color:#75715e"># context/project UI 环境变量引用</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">postgres:9.4.1</span> <span style="color:#75715e"># 次镜像</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">username</span>: <span style="color:#ae81ff">mydockerhub-user</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">password</span>: <span style="color:#ae81ff">$DOCKERHUB_PASSWORD </span> <span style="color:#75715e"># context/project UI 环境变量引用</span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># 次容器可以通过 localhost 访问主容器</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">environment</span>: <span style="color:#75715e"># 指定环境变量</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">POSTGRES_USER</span>: <span style="color:#ae81ff">root</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">build2</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">machine</span>: <span style="color:#75715e"># 使用 Linux 环境</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">image</span>: <span style="color:#ae81ff">ubuntu-2004:202010-01</span> <span style="color:#75715e"># 指定 Linux VM 版本 </span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">build3</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">macos</span>: <span style="color:#75715e"># 使用 macOS 环境</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">xcode</span>: <span style="color:#e6db74">&#34;11.3.0&#34;</span> <span style="color:#75715e"># 指定 Xcode 版本</span>
</span></span></code></pre></div><h3 id="step">
  Step
  <a class="anchor" href="#step">#</a>
</h3>
<p>步骤通常是一组可执行命令，例如内置命令 <code>checkout</code> 通过 SSH 检查源码；<code>run</code> 可以自定义命令。命令可以定义成全局，供多次使用。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">docker</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">&lt;image-name-tag&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">username</span>: <span style="color:#ae81ff">mydockerhub-user</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">password</span>: <span style="color:#ae81ff">$DOCKERHUB_PASSWORD </span> <span style="color:#75715e"># context/project UI 环境变量引用</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">checkout</span> <span style="color:#75715e"># 内置 step，checkout 代码</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">run</span>: <span style="color:#75715e"># 内置 step，用于执行命令</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Running tests</span> <span style="color:#75715e"># step 名称</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">command</span>: <span style="color:#ae81ff">make test</span> <span style="color:#75715e"># 默认情况下，可执行命令在非登录 shell 中使用 /bin/bash -eo pipefail 选项运行。</span>
</span></span></code></pre></div><h3 id="image">
  Image
  <a class="anchor" href="#image">#</a>
</h3>
<p>镜像就是一个打包的系统，在 <em>.circleci/config.yml</em> 中定义的主镜像，这是 Docker 或者其他执行器执行 Job 命令的地方。</p>
<h3 id="workflow">
  Workflow
  <a class="anchor" href="#workflow">#</a>
</h3>
<p>工作流定义了 Job 列表及其运行顺序。可以并行、串行、按计划或使用 approval 的来运行 Job。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">#...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">workflows</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build_and_test</span>: <span style="color:#75715e"># workflow 名称</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>    	- <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">test</span>: <span style="color:#75715e"># test 依赖 build 执行成功 </span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requires</span>: 
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">hold</span>: <span style="color:#75715e"># hold 依赖 build 和 test 执行成功，并且需要 approve</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">type</span>: <span style="color:#ae81ff">approval</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requires</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">test</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">deploy</span>: <span style="color:#75715e"># deploy 依赖 hold 执行成功 </span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requires</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">hold</span>
</span></span></code></pre></div><h3 id="cacheworkspaceartifact">
  Cache/Workspace/Artifact
  <a class="anchor" href="#cacheworkspaceartifact">#</a>
</h3>
<ul>
<li>Cache 在对象存储中保存的是文件或文件目录，例如依赖项或源代码。每个作业都可能包含特殊步骤，例如使用先前作业缓存的依赖项来加速构建。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#ae81ff">2.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">docker</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">&lt;image-name-tag&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">username</span>: <span style="color:#ae81ff">mydockerhub-user</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">password</span>: <span style="color:#ae81ff">$DOCKERHUB_PASSWORD </span> <span style="color:#75715e"># context/project UI 环境变量引用</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">checkout</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">save_cache</span>: <span style="color:#75715e"># 内置 step，cache 依赖环境变量提供的 key</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">v1-repo-{{ .Environment.CIRCLE_SHA1 }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">~/circleci-demo-workflows</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># build2 使用 build1 的缓存</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">docker</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">&lt;image-name-tag&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">username</span>: <span style="color:#ae81ff">mydockerhub-user</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">password</span>: <span style="color:#ae81ff">$DOCKERHUB_PASSWORD </span> <span style="color:#75715e"># context/project UI 环境变量引用</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">restore_cache</span>: <span style="color:#75715e"># 内置 step，恢复缓存依赖项</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">v1-repo-{{ .Environment.CIRCLE_SHA1 }}</span>
</span></span></code></pre></div><ul>
<li>Workspace 是一种感知 Workflow 的存储机制。Workspace 保存 Job 独有的数据，下游 Job 可能需要这些数据。每个 Workflow 都有一个与之关联的临时 Workspace。Workspace 可用于将同一 Workflow 下某个 Job 在执行期间构建的特殊数据传递给其他 Job。</li>
<li>Artifact 在 Workflow 完成后保留数据，可用于构建并输出长期存储。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#ae81ff">2.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build1</span>:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">persist_to_workspace</span>: <span style="color:#75715e"># 内置 step</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># 将指定路径(workspace/echo-output) 保留到 Workspace 中以供下游 Job 使用</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># 路径必须是绝对路径，或来自 working_directory 的相对路径。</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># 这是容器里的目录，是工作空间的根目录。</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">root</span>: <span style="color:#ae81ff">workspace</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 必须是根目录的相对路径</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">echo-output</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build2</span>:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">attach_workspace</span>: <span style="color:#75715e"># 内置 step</span>
</span></span><span style="display:flex;"><span>      		<span style="color:#75715e"># 路径必须是绝对路径，或来自 working_directory 的相对路径。</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">at</span>: <span style="color:#ae81ff">/tmp/workspace</span>
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build3</span>:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">store_artifacts</span>: <span style="color:#75715e"># 内置 step</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/tmp/artifact-1</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">artifact-file</span>
</span></span></code></pre></div><h2 id="小结">
  小结
  <a class="anchor" href="#%e5%b0%8f%e7%bb%93">#</a>
</h2>
<p>走到这里，应该对 Circle CI 有了粗浅的认识，但想要上手甚至是玩转，还需要更多指导和实践。这是初次尝试 Circle CI 时写 
  <a href="https://github.com/howieyuen/hello-circle-ci/blob/circleci-project-setup/.circleci/config.yml">config.yml</a>。当然 Circle CI 提供了丰富的配置项，详情可以移步这里：
  <a href="https://circleci.com/docs/2.0/configuration-reference/">Circle CI 配置参考</a>。</p>
<h1 id="orb-简介">
  Orb 简介
  <a class="anchor" href="#orb-%e7%ae%80%e4%bb%8b">#</a>
</h1>
<p>Circle CI 
  <a href="https://circleci.com/docs/2.0/orb-concepts/">Orb</a> 是可共享的配置包，可以看做是 lib 库，选择合适的 Orb ，会让 Circle CI 配置编写更容易。Orb 中可配置元素主要包括：Command、Executor 和 Job。</p>
<h2 id="command-示例">
  Command 示例
  <a class="anchor" href="#command-%e7%a4%ba%e4%be%8b">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#ae81ff">2.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">orbs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">aws-s3</span>: <span style="color:#ae81ff">circleci/aws-s3@x.y.z</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">docker</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">image</span>: <span style="color:#e6db74">&#39;cimg/python:3.6&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">username</span>: <span style="color:#ae81ff">mydockerhub-user</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">password</span>: <span style="color:#ae81ff">$DOCKERHUB_PASSWORD </span> <span style="color:#75715e"># context/project UI 环境变量引用</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">checkout</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">run</span>: <span style="color:#ae81ff">mkdir bucket &amp;&amp; echo &#34;lorem ipsum&#34; &gt; bucket/build_asset.txt</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># 使用orb：aws-s3 的 copy 命令</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">aws-s3/copy</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">from</span>: <span style="color:#ae81ff">bucket/build_asset.txt</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">to</span>: <span style="color:#e6db74">&#39;s3://my-s3-bucket-name&#39;</span>
</span></span></code></pre></div><h2 id="executor-示例">
  Executor 示例
  <a class="anchor" href="#executor-%e7%a4%ba%e4%be%8b">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">description</span>: &gt;<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Select the version of NodeJS to use. Uses CircleCI&#39;s highly cached convenience
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  images built for CI.</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">docker</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">image</span>: <span style="color:#e6db74">&#39;cimg/node:&lt;&lt;parameters.tag&gt;&gt;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">username</span>: <span style="color:#ae81ff">mydockerhub-user</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">password</span>: <span style="color:#ae81ff">$DOCKERHUB_PASSWORD </span> <span style="color:#75715e"># context/project UI 环境变量引用</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">parameters</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tag</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">default</span>: <span style="color:#e6db74">&#39;13.11&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">description</span>: &gt;<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      Pick a specific cimg/node image version tag:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      https://hub.docker.com/r/cimg/node</span>      
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">string</span>
</span></span></code></pre></div><h2 id="job-示例">
  Job 示例
  <a class="anchor" href="#job-%e7%a4%ba%e4%be%8b">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#ae81ff">2.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">orbs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;orb&gt;</span>: <span style="color:#ae81ff">&lt;namespace&gt;/&lt;orb&gt;@x.y</span> <span style="color:#75715e">#orb 版本</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">workflows</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">use-orb-job</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">&lt;orb&gt;/&lt;job-name&gt;</span>
</span></span></code></pre></div><h1 id="orb-开发实践">
  Orb 开发实践
  <a class="anchor" href="#orb-%e5%bc%80%e5%8f%91%e5%ae%9e%e8%b7%b5">#</a>
</h1>
<p>Orb 实践，简单来说包括这些阶段：取名、分类、说明、context 限制、发布、升级。在实践之前，先安装 Orb 开发套件：
  <a href="https://circleci.com/docs/2.0/local-cli/"><em>circleci</em></a>。</p>
<h2 id="取名">
  取名
  <a class="anchor" href="#%e5%8f%96%e5%90%8d">#</a>
</h2>
<p>一个好的 Orb 命名，是由 Namespace + 名称组成，由正斜杠分隔。Namespace 代表拥有和维护 Orb 的个人、公司或组织，而 Orb 名称本身应描述提供的产品、服务或操作。取名之前，先注册 Namespace，这里需要关联 Circle CI 帐号，所以需要获取 
  <a href="https://app.circleci.com/settings/user/tokens">Access Token</a>（注意保存），然后就可以使用
  <a href="https://circleci.com/docs/2.0/orb-author-intro/#register-a-namespace">注册 Namespace</a> 命令 <code>circleci namespace create &lt;name&gt; &lt;vcs-type&gt; &lt;org-name&gt; [flags]</code>，详细如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ circleci namespace create howieyuen-orb github howieyuen --token 5b8b950571bbe70ad5fa15e22ec052b52702f241
</span></span><span style="display:flex;"><span>You are creating a namespace called <span style="color:#e6db74">&#34;howieyuen-orb&#34;</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>This is the only namespace permitted <span style="color:#66d9ef">for</span> your github organization, howieyuen.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>To change the namespace, you will have to contact CircleCI customer support.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>? Are you sure you wish to create the namespace: <span style="color:#e6db74">`</span>howieyuen-orb<span style="color:#e6db74">`</span> Yes
</span></span><span style="display:flex;"><span>Namespace <span style="color:#e6db74">`</span>howieyuen-orb<span style="color:#e6db74">`</span> created.
</span></span><span style="display:flex;"><span>Please note that any orbs you publish in this namespace are open orbs and are world-readable.
</span></span></code></pre></div><h2 id="初始化">
  初始化
  <a class="anchor" href="#%e5%88%9d%e5%a7%8b%e5%8c%96">#</a>
</h2>
<p><em>circleci</em> 工具提供了
  <a href="https://circleci.com/docs/2.0/orb-author/#orb-development-kit">初始化 Orb</a> 命令：<code>circleci orb init</code>。它包含了分类、说明等操作。但有几个前置操作需要完成：</p>
<ol>
<li>设置 
  <a href="https://circleci.com/docs/2.0/contexts/#restricting-a-context">Context</a>：Organization Settings &gt; Contexts</li>
<li>
  <a href="https://circleci.com/docs/2.0/orbs-faq/#using-uncertified-orbs">启用 Uncertified Orbs</a>：Organization Settings &gt; Security</li>
<li>新建 GitHub Repo：
  <a href="https://github.com/howieyuen/hello-circleci-orb">https://github.com/howieyuen/hello-circleci-orb</a></li>
</ol>
<p>到此，就可以执行初始化命令 <code>circleci orb init &lt;path&gt; [flags]</code>，详细如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜ circleci orb init hello-circleci-orb --token 5b8b950571bbe70ad5fa15e22ec052b52702f241
</span></span><span style="display:flex;"><span>Note: This command is in preview. Please report any bugs! https://github.com/CircleCI-Public/circleci-cli/issues/new/choose
</span></span><span style="display:flex;"><span>? Would you like to perform an automated setup of this orb? Yes, walk me through the process.
</span></span><span style="display:flex;"><span>Downloading Orb Project Template into hello-circleci-orb
</span></span><span style="display:flex;"><span>A few questions to get you up and running.
</span></span><span style="display:flex;"><span>? Are you using GitHub or Bitbucket? GitHub
</span></span><span style="display:flex;"><span>? Enter your github username or organization howieyuen
</span></span><span style="display:flex;"><span>? Enter the namespace to use <span style="color:#66d9ef">for</span> this orb howieyuen-orb
</span></span><span style="display:flex;"><span>Saving namespace howieyuen-orb as default
</span></span><span style="display:flex;"><span>? Orb name hello-circleci-orb
</span></span><span style="display:flex;"><span>? What categories will this orb belong to? Testing
</span></span><span style="display:flex;"><span>? Automatically set up a publishing context <span style="color:#66d9ef">for</span> your orb? Yes, set up a publishing context with my API key.
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>orb-publishing<span style="color:#e6db74">`</span> context already exists, continuing on
</span></span><span style="display:flex;"><span>? Would you like to set up your git project? Yes
</span></span><span style="display:flex;"><span>? Enter your primary git branch. main
</span></span><span style="display:flex;"><span>? Enter the remote git repository git@github.com:howieyuen/hello-circleci-orb.git
</span></span><span style="display:flex;"><span>Thank you! Setting up your orb...
</span></span><span style="display:flex;"><span>An initial commit has been created - please run <span style="color:#e6db74">&#39;git push origin main&#39;</span> to publish your first commit!
</span></span><span style="display:flex;"><span>? I have pushed to my git repository using the above command Yes
</span></span><span style="display:flex;"><span>Your orb project is building here: https://circleci.com/gh/howieyuen/hello-circleci-orb
</span></span><span style="display:flex;"><span>You are now working in the alpha branch.
</span></span><span style="display:flex;"><span>Once the first public version is published, you<span style="color:#960050;background-color:#1e0010">&#39;</span>ll be able to see it here: https://circleci.com/developer/orbs/orb/howieyuen-orb/hello-circleci-orb
</span></span><span style="display:flex;"><span>View orb publishing doc: https://circleci.com/docs/2.0/orb-author
</span></span></code></pre></div><p>该步骤完成后，项目默认位于 alpha 分支，该分支代码是从模板克隆，模板详见
  <a href="https://github.com/CircleCI-Public/Orb-Project-Template">链接</a>。</p>
<h2 id="发布">
  发布
  <a class="anchor" href="#%e5%8f%91%e5%b8%83">#</a>
</h2>
<p>在发布之前，可以将 alpha 分支，推送到远端，触发 <em>test-pack workflow</em>，执行基本验证、lint 和单元测试。</p>
<p>目前为止，Orb 只是在 dev 阶段，其他用户无法从 
  <a href="https://circleci.com/developer/orbs">Orb 市场</a>检索到。正式发布的流程也很简单，是根据 Orb 仓库的 Commit Message 的前缀字段 <code>[semver:&lt;increment&gt;]</code>，来确定是否需要发布，以及发布的版本号。Orb 发布也遵循
  <a href="https://circleci.com/docs/2.0/orb-concepts/#semantic-versioning">语义化版本</a> 控制：</p>
<table>
<thead>
<tr>
<th>Increment</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>major</td>
<td>发布 1.0.0 增量版本</td>
</tr>
<tr>
<td>minor</td>
<td>发布 x.1.0 增量版本</td>
</tr>
<tr>
<td>patch</td>
<td>发布 xx1 增量版本</td>
</tr>
<tr>
<td>skip</td>
<td>不要发布版本</td>
</tr>
</tbody>
</table>
<p>因此，发布版本，只需要修改 alpha 分支的 commit message，将 “skip” 改成 <em>increment</em> 任何一个值即可，Circle CI 就会触发 <em>integration_test_deploy</em> 工作流，待完成后，即可在 
  <a href="https://circleci.com/developer/orbs">Orb 市场</a>检索到刚才发布的 Orb：
  <a href="https://circleci.com/developer/orbs/orb/howieyuen-orb/hello-circleci-orb">howieyuen-orb/hello-circleci-orb@1.0.0</a>。</p>
<h1 id="参考资料">
  参考资料
  <a class="anchor" href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99">#</a>
</h1>
<ul>
<li>
  <a href="[https://circleci.com/docs/2.0/concepts/]%28https://circleci.com/docs/2.0/concepts/#%29">Circle CI 基本概念</a></li>
<li>
  <a href="https://circleci.com/docs/2.0/sample-config">Circle CI 配置样例</a></li>
<li>
  <a href="https://circleci.com/docs/2.0/configuration-reference/#">Circle CI 配置参考</a></li>
<li>
  <a href="https://circleci.com/docs/2.0/reusing-config/">Circle CI 可重用配置指南</a></li>
<li>
  <a href="https://circleci.com/docs/2.0/orb-intro/">Orb 介绍</a></li>
<li>
  <a href="https://circleci.com/docs/2.0/orb-concepts/">Orb 概念</a></li>
<li>
  <a href="https://circleci.com/docs/2.0/local-cli/">CircleCI 本地 CLI</a></li>
</ul></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/howieyuen/howieyuen.github.io/commit/6669e2cc4afd0f595953450486773e5a73749409" title='Last modified by howieyuen | October 15, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>October 15, 2022</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">



<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'b4cc17dbafc8ad637453',
    clientSecret: '77b4685b4d6da0280eca116a66b6f01244033d35',
    repo: 'howieyuen.github.io',
    owner: 'howieyuen',
    admin: ['howieyuen'],
    id: location.pathname, 
    distractionFreeMode: false 
  });
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
      return;
    }
    gitalk.render('gitalk-container');
  })();
</script>

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#基本概念">基本概念</a>
      <ul>
        <li><a href="#管控层">管控层</a>
          <ul>
            <li><a href="#project">Project</a></li>
            <li><a href="#configuration">Configuration</a></li>
            <li><a href="#user-type">User Type</a></li>
          </ul>
        </li>
        <li><a href="#配置层">配置层</a>
          <ul>
            <li><a href="#pipeline">Pipeline</a></li>
            <li><a href="#orb">Orb</a></li>
            <li><a href="#job">Job</a></li>
            <li><a href="#executor-和-images">Executor 和 images</a></li>
            <li><a href="#step">Step</a></li>
            <li><a href="#image">Image</a></li>
            <li><a href="#workflow">Workflow</a></li>
            <li><a href="#cacheworkspaceartifact">Cache/Workspace/Artifact</a></li>
          </ul>
        </li>
        <li><a href="#小结">小结</a></li>
      </ul>
    </li>
    <li><a href="#orb-简介">Orb 简介</a>
      <ul>
        <li><a href="#command-示例">Command 示例</a></li>
        <li><a href="#executor-示例">Executor 示例</a></li>
        <li><a href="#job-示例">Job 示例</a></li>
      </ul>
    </li>
    <li><a href="#orb-开发实践">Orb 开发实践</a>
      <ul>
        <li><a href="#取名">取名</a></li>
        <li><a href="#初始化">初始化</a></li>
        <li><a href="#发布">发布</a></li>
      </ul>
    </li>
    <li><a href="#参考资料">参考资料</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












